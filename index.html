<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Variables de Texto para Figma</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0;
            padding: 0;
        }
        .empty-field {
            border-color: #FF6600 !important;
            border-width: 2px !important;
        }
        .near-limit {
            border-color: #FFA500 !important;
            border-width: 2px !important;
        }
        .at-limit {
            border-color: #FF4444 !important;
            border-width: 2px !important;
        }
        .dark {
            background-color: #2C2C2C;
            color: #FFFFFF;
        }
        .dark .bg-white {
            background-color: #2C2C2C !important;
        }
        .dark .bg-gray-50 {
            background-color: #3A3A3A !important;
        }
        .dark .text-gray-900 {
            color: #FFFFFF !important;
        }
        .dark .text-gray-600 {
            color: #CCCCCC !important;
        }
        .dark .text-gray-500 {
            color: #AAAAAA !important;
        }
        .dark .border-gray-200 {
            border-color: #555555 !important;
        }
        .dark .border-gray-300 {
            border-color: #666666 !important;
        }
        .dark .hover\:bg-gray-50:hover {
            background-color: #3A3A3A !important;
        }
        .dark .hover\:bg-gray-100:hover {
            background-color: #444444 !important;
        }
        /* Loading fallback */
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="loading">Cargando Editor de Variables...</div>
    <div id="root"></div>
    
    <script type="text/babel">
        console.log('üöÄ Iniciando editor...');
        
        // Check if React loaded
        if (typeof React === 'undefined') {
            document.getElementById('loading').innerHTML = '‚ùå Error: React no se carg√≥. Revisa tu conexi√≥n a internet.';
            throw new Error('React not loaded');
        }
        
        console.log('‚úÖ React cargado');
        
        const { useState, useRef, useEffect } = React;

        // Simple fallback icons as text
        const iconFallbacks = {
            GripVertical: '‚ãÆ‚ãÆ',
            Plus: '+',
            Trash2: 'üóëÔ∏è',
            Download: '‚¨áÔ∏è',
            Upload: '‚¨ÜÔ∏è',
            Settings: '‚öôÔ∏è',
            FolderOpen: 'üìÅ',
            Save: 'üíæ',
            X: '‚úï',
            ChevronDown: '‚ñº',
            Edit: '‚úèÔ∏è',
            File: 'üìÑ'
        };

        // Icons with fallback
        const Icon = ({ name, size = 16, className = "" }) => {
            return (
                <span className={`inline-block ${className}`} style={{ fontSize: `${size}px` }}>
                    {iconFallbacks[name] || '‚óè'}
                </span>
            );
        };

        const FigmaVariablesEditor = () => {
            console.log('üé® Renderizando componente principal...');
            
            const [collectionName, setCollectionName] = useState('Bnp Projects');
            const [modes, setModes] = useState(['SPA', 'POR', 'ENG']);
            const [variables, setVariables] = useState([
                {
                    id: '1',
                    name: 'kicker',
                    values: {
                        'SPA': '¬°Exploradores del futuro!',
                        'POR': 'Exploradores do Futuro!',
                        'ENG': 'Future Explorers!'
                    },
                    charLimit: 50
                }
            ]);

            const [darkMode, setDarkMode] = useState(false);
            const [editingProjectName, setEditingProjectName] = useState(false);
            const [currentProject, setCurrentProject] = useState(null);

            // Load dark mode on mount
            useEffect(() => {
                console.log('‚öôÔ∏è Configurando modo oscuro...');
                const savedDarkMode = localStorage.getItem('figma-dark-mode');
                if (savedDarkMode) {
                    setDarkMode(JSON.parse(savedDarkMode));
                }
            }, []);

            // Save dark mode preference
            useEffect(() => {
                localStorage.setItem('figma-dark-mode', JSON.stringify(darkMode));
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            const addVariable = () => {
                const newVariable = {
                    id: Date.now().toString(),
                    name: `new-variable-${variables.length + 1}`,
                    values: modes.reduce((acc, mode) => ({ ...acc, [mode]: '' }), {}),
                    charLimit: 50
                };
                setVariables([...variables, newVariable]);
            };

            const removeVariable = (id) => {
                setVariables(variables.filter(v => v.id !== id));
            };

            const updateVariableName = (id, name) => {
                setVariables(variables.map(v => v.id === id ? { ...v, name } : v));
            };

            const updateVariableValue = (id, mode, value) => {
                const variable = variables.find(v => v.id === id);
                if (!variable) return;

                const limitedValue = value.length > variable.charLimit 
                    ? value.substring(0, variable.charLimit) 
                    : value;

                setVariables(variables.map(v => 
                    v.id === id ? { 
                        ...v, 
                        values: { ...v.values, [mode]: limitedValue }
                    } : v
                ));
            };

            const getCountColor = (length, limit) => {
                const ratio = length / limit;
                if (ratio >= 1) return 'color: #DC2626; font-weight: bold;';
                if (ratio >= 0.9) return 'color: #EA580C; font-weight: 600;';
                if (ratio > 0.8) return 'color: #D97706;';
                return darkMode ? 'color: #9CA3AF;' : 'color: #6B7280;';
            };

            console.log('üéØ Renderizando UI...');

            return React.createElement('div', {
                className: `min-h-screen transition-colors duration-200 ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`,
                style: { fontFamily: 'Inter, sans-serif' }
            }, [
                // Header
                React.createElement('div', {
                    key: 'header',
                    className: `${darkMode ? 'bg-gray-800' : 'bg-white'} border-b ${darkMode ? 'border-gray-700' : 'border-gray-200'}`,
                    style: { padding: '16px 24px' }
                }, [
                    // Top Row
                    React.createElement('div', {
                        key: 'top-row',
                        className: 'flex items-center justify-between',
                        style: { marginBottom: '32px' }
                    }, [
                        React.createElement('div', {
                            key: 'title-section',
                            className: 'flex items-center gap-2'
                        }, [
                            editingProjectName 
                                ? React.createElement('input', {
                                    key: 'title-input',
                                    type: 'text',
                                    value: collectionName,
                                    onChange: (e) => setCollectionName(e.target.value),
                                    onBlur: () => setEditingProjectName(false),
                                    onKeyDown: (e) => {
                                        if (e.key === 'Enter') setEditingProjectName(false);
                                    },
                                    className: `text-2xl font-medium tracking-wide bg-transparent border-none outline-none ${darkMode ? 'text-white' : 'text-black'}`,
                                    autoFocus: true,
                                    style: { fontSize: '27px', lineHeight: '1.1', letterSpacing: '0.01em' }
                                })
                                : React.createElement('h1', {
                                    key: 'title-text',
                                    className: `text-2xl font-medium tracking-wide cursor-pointer ${darkMode ? 'text-white' : 'text-black'}`,
                                    onClick: () => setEditingProjectName(true),
                                    style: { fontSize: '27px', lineHeight: '1.1', letterSpacing: '0.01em' }
                                }, collectionName),
                            React.createElement('button', {
                                key: 'edit-btn',
                                onClick: () => setEditingProjectName(true),
                                className: `${darkMode ? 'text-gray-400 hover:text-white' : 'text-gray-600 hover:text-black'} transition-colors`
                            }, React.createElement(Icon, { name: 'Edit', size: 16 }))
                        ]),
                        React.createElement('div', {
                            key: 'dark-mode-section',
                            className: 'flex items-center gap-2'
                        }, [
                            React.createElement('span', {
                                key: 'dark-label',
                                className: `text-xs font-semibold tracking-wide ${darkMode ? 'text-white' : 'text-black'}`,
                                style: { fontSize: '10px', letterSpacing: '0.01em' }
                            }, 'Dark Mode'),
                            React.createElement('button', {
                                key: 'dark-toggle',
                                onClick: () => setDarkMode(!darkMode),
                                className: `relative rounded border transition-colors`,
                                style: {
                                    width: '24px',
                                    height: '24px',
                                    borderColor: darkMode ? 'white' : 'black',
                                    backgroundColor: 'white'
                                }
                            }, darkMode && React.createElement('div', {
                                className: 'absolute bg-black rounded',
                                style: { inset: '4px' }
                            }))
                        ])
                    ]),
                    // Bottom Row
                    React.createElement('div', {
                        key: 'bottom-row',
                        className: 'flex items-center justify-between'
                    }, [
                        React.createElement('div', {
                            key: 'file-info',
                            className: 'flex items-center gap-2'
                        }, [
                            React.createElement(Icon, { key: 'file-icon', name: 'File', size: 16, className: darkMode ? 'text-white' : 'text-black' }),
                            React.createElement('span', {
                                key: 'file-text',
                                className: `text-xs font-semibold tracking-wide ${darkMode ? 'text-white' : 'text-black'}`,
                                style: { fontSize: '10px', letterSpacing: '0.01em' }
                            }, currentProject ? `Editando: ${currentProject.name}` : 'Sin proyecto cargado')
                        ]),
                        React.createElement('div', {
                            key: 'button-deck',
                            className: 'flex items-center gap-4'
                        }, [
                            React.createElement('button', {
                                key: 'btn-simple',
                                className: `flex items-center gap-2 text-xs font-semibold tracking-wide border transition-colors ${darkMode ? 'border-white text-white hover:bg-gray-700' : 'border-black text-black hover:bg-gray-50'}`,
                                style: { padding: '4px 8px', fontSize: '10px', letterSpacing: '0.01em' },
                                onClick: () => alert('¬°Funciona! Versi√≥n simplificada del editor.')
                            }, [
                                React.createElement(Icon, { key: 'btn-icon', name: 'FolderOpen', size: 16 }),
                                'Editor Simplificado'
                            ])
                        ])
                    ])
                ]),
                
                // Main Content
                React.createElement('div', {
                    key: 'content',
                    style: { margin: '24px', padding: '24px' },
                    className: `${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm border ${darkMode ? 'border-gray-700' : 'border-gray-200'}`
                }, [
                    React.createElement('h2', {
                        key: 'content-title',
                        className: `text-lg font-semibold mb-4 ${darkMode ? 'text-white' : 'text-gray-900'}`
                    }, 'Variables de Texto'),
                    
                    // Variables List
                    ...variables.map((variable, index) => 
                        React.createElement('div', {
                            key: variable.id,
                            className: `p-4 mb-4 border rounded ${darkMode ? 'border-gray-600 bg-gray-700' : 'border-gray-200 bg-gray-50'}`
                        }, [
                            React.createElement('div', {
                                key: 'var-header',
                                className: 'flex items-center justify-between mb-3'
                            }, [
                                React.createElement('input', {
                                    key: 'var-name',
                                    type: 'text',
                                    value: variable.name,
                                    onChange: (e) => updateVariableName(variable.id, e.target.value),
                                    className: `font-bold text-sm px-2 py-1 border rounded ${darkMode ? 'bg-gray-600 text-white border-gray-500' : 'bg-white text-black border-gray-300'}`,
                                    placeholder: 'nombre-variable'
                                }),
                                React.createElement('button', {
                                    key: 'var-delete',
                                    onClick: () => removeVariable(variable.id),
                                    className: `text-red-500 hover:text-red-700 px-2 py-1`,
                                    title: 'Eliminar variable'
                                }, React.createElement(Icon, { name: 'Trash2', size: 16 }))
                            ]),
                            
                            React.createElement('div', {
                                key: 'var-modes',
                                className: 'grid gap-3',
                                style: { gridTemplateColumns: `repeat(${modes.length}, 1fr)` }
                            }, modes.map(mode => 
                                React.createElement('div', {
                                    key: mode,
                                    className: 'space-y-2'
                                }, [
                                    React.createElement('label', {
                                        key: 'mode-label',
                                        className: `block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'}`
                                    }, mode),
                                    React.createElement('textarea', {
                                        key: 'mode-input',
                                        value: variable.values[mode] || '',
                                        onChange: (e) => updateVariableValue(variable.id, mode, e.target.value),
                                        maxLength: variable.charLimit,
                                        className: `w-full px-3 py-2 text-sm border rounded resize-none ${darkMode ? 'bg-gray-600 text-white border-gray-500' : 'bg-white text-black border-gray-300'}`,
                                        rows: 2,
                                        placeholder: `Texto en ${mode}...`
                                    }),
                                    React.createElement('div', {
                                        key: 'mode-counter',
                                        className: 'text-xs',
                                        style: getCountColor((variable.values[mode] || '').length, variable.charLimit)
                                    }, `${(variable.values[mode] || '').length}/${variable.charLimit}`)
                                ])
                            ))
                        ])
                    ),
                    
                    React.createElement('button', {
                        key: 'add-btn',
                        onClick: addVariable,
                        className: `flex items-center gap-2 px-4 py-2 text-sm border rounded-md transition-colors ${darkMode ? 'text-gray-300 border-gray-600 hover:bg-gray-700' : 'text-gray-600 border-gray-300 hover:bg-gray-50'}`
                    }, [
                        React.createElement(Icon, { key: 'add-icon', name: 'Plus', size: 16 }),
                        'Agregar Variable'
                    ])
                ]),
                
                // Footer
                React.createElement('div', {
                    key: 'footer',
                    className: `mt-6 text-center text-sm pb-6 ${darkMode ? 'text-gray-400' : 'text-gray-500'}`
                }, 'Editor de Variables de Texto para Figma v6.1 - Versi√≥n Simplificada')
            ]);
        };

        try {
            console.log('üé¨ Iniciando ReactDOM...');
            
            // Hide loading
            document.getElementById('loading').style.display = 'none';
            
            // Render
            ReactDOM.render(
                React.createElement(FigmaVariablesEditor),
                document.getElementById('root')
            );
            
            console.log('‚úÖ Editor cargado exitosamente!');
            
        } catch (error) {
            console.error('‚ùå Error al cargar:', error);
            document.getElementById('loading').innerHTML = `‚ùå Error: ${error.message}`;
        }
    </script>
</body>
</html>
