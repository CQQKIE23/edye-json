<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Variables de Texto para Figma</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // Icons
        const GripVertical = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="9" cy="12" r="1"></circle>
                <circle cx="9" cy="5" r="1"></circle>
                <circle cx="9" cy="19" r="1"></circle>
                <circle cx="15" cy="12" r="1"></circle>
                <circle cx="15" cy="5" r="1"></circle>
                <circle cx="15" cy="19" r="1"></circle>
            </svg>
        );

        const Plus = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="m19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const Download = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7,10 12,15 17,10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17,8 12,3 7,8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Settings = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="m12 1 1.4 1.4a2 2 0 0 0 1.4.6h2a2 2 0 0 1 2 2v2a2 2 0 0 0 .6 1.4L21 12l-1.4 1.4a2 2 0 0 0-.6 1.4v2a2 2 0 0 1-2 2h-2a2 2 0 0 0-1.4.6L12 23l-1.4-1.4a2 2 0 0 0-1.4-.6H7a2 2 0 0 1-2-2v-2a2 2 0 0 0-.6-1.4L3 12l1.4-1.4a2 2 0 0 0 .6-1.4V7a2 2 0 0 1 2-2h2a2 2 0 0 0 1.4-.6L12 1Z"></path>
            </svg>
        );

        const FigmaVariablesEditor = () => {
            const [collectionName, setCollectionName] = useState('Languages');
            const [modes, setModes] = useState(['SPA', 'POR', 'ENG']);
            const [variables, setVariables] = useState([
                {
                    id: '1',
                    name: 'kicker',
                    values: {
                        'SPA': '¡Exploradores del futuro!',
                        'POR': 'Exploradores do Futuro!',
                        'ENG': 'Future Explorers!'
                    },
                    charLimit: 50
                }
            ]);

            const [draggedItem, setDraggedItem] = useState(null);
            const [editingLimit, setEditingLimit] = useState(null);
            const fileInputRef = useRef(null);

            // Add new mode
            const addMode = () => {
                const newMode = prompt('Nombre del nuevo modo (ej: FRA, ITA):');
                if (newMode && !modes.includes(newMode)) {
                    setModes([...modes, newMode]);
                    setVariables(variables.map(variable => ({
                        ...variable,
                        values: { ...variable.values, [newMode]: '' }
                    })));
                }
            };

            // Remove mode
            const removeMode = (modeToRemove) => {
                if (modes.length <= 1) return;
                setModes(modes.filter(mode => mode !== modeToRemove));
                setVariables(variables.map(variable => {
                    const newValues = { ...variable.values };
                    delete newValues[modeToRemove];
                    return { ...variable, values: newValues };
                }));
            };

            // Add new variable
            const addVariable = () => {
                const newVariable = {
                    id: Date.now().toString(),
                    name: `new-variable-${variables.length + 1}`,
                    values: modes.reduce((acc, mode) => ({ ...acc, [mode]: '' }), {}),
                    charLimit: 50
                };
                setVariables([...variables, newVariable]);
            };

            // Remove variable
            const removeVariable = (id) => {
                setVariables(variables.filter(v => v.id !== id));
            };

            // Update variable name
            const updateVariableName = (id, name) => {
                setVariables(variables.map(v => v.id === id ? { ...v, name } : v));
            };

            // Update variable value
            const updateVariableValue = (id, mode, value) => {
                setVariables(variables.map(v => 
                    v.id === id ? { 
                        ...v, 
                        values: { ...v.values, [mode]: value }
                    } : v
                ));
            };

            // Update character limit
            const updateLimit = (id, limit) => {
                setVariables(variables.map(v => 
                    v.id === id ? { 
                        ...v, 
                        charLimit: parseInt(limit) || 50
                    } : v
                ));
                setEditingLimit(null);
            };

            // Get character count color
            const getCountColor = (length, limit) => {
                const ratio = length / limit;
                if (ratio > 1) return 'text-red-500';
                if (ratio > 0.8) return 'text-yellow-600';
                return 'text-gray-500';
            };

            // Drag and drop handlers
            const handleDragStart = (e, index) => {
                setDraggedItem(index);
                e.dataTransfer.effectAllowed = 'move';
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
            };

            const handleDrop = (e, dropIndex) => {
                e.preventDefault();
                if (draggedItem === null) return;

                const newVariables = [...variables];
                const draggedVariable = newVariables[draggedItem];
                newVariables.splice(draggedItem, 1);
                newVariables.splice(dropIndex, 0, draggedVariable);
                
                setVariables(newVariables);
                setDraggedItem(null);
            };

            // Export JSON
            const exportJSON = () => {
                try {
                    const jsonData = {
                        collections: [{
                            name: collectionName,
                            modes: modes,
                            variables: variables.reduce((acc, variable) => {
                                acc[variable.name] = {
                                    type: 'string',
                                    values: variable.values
                                };
                                return acc;
                            }, {})
                        }]
                    };

                    const jsonString = JSON.stringify(jsonData, null, 4);
                    const blob = new Blob([jsonString], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${collectionName.toLowerCase().replace(/\s+/g, '-')}.json`;
                    a.style.display = 'none';
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                } catch (error) {
                    const jsonData = {
                        collections: [{
                            name: collectionName,
                            modes: modes,
                            variables: variables.reduce((acc, variable) => {
                                acc[variable.name] = {
                                    type: 'string',
                                    values: variable.values
                                };
                                return acc;
                            }, {})
                        }]
                    };
                    
                    const jsonString = JSON.stringify(jsonData, null, 4);
                    const newWindow = window.open();
                    newWindow.document.write(`<pre>${jsonString}</pre>`);
                    newWindow.document.title = 'Figma Variables JSON';
                    alert('JSON mostrado en ventana nueva - copia el contenido');
                }
            };

            // Import JSON
            const importJSON = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        const collection = data.collections[0];
                        
                        setCollectionName(collection.name);
                        setModes(collection.modes);
                        
                        const newVariables = Object.entries(collection.variables).map(([name, variable], index) => ({
                            id: index.toString(),
                            name,
                            values: variable.values,
                            charLimit: 50
                        }));
                        
                        setVariables(newVariables);
                        alert('JSON importado exitosamente!');
                    } catch (error) {
                        alert('Error al importar JSON: ' + error.message);
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <input
                                    type="text"
                                    value={collectionName}
                                    onChange={(e) => setCollectionName(e.target.value)}
                                    className="text-2xl font-semibold text-gray-900 bg-transparent border-none outline-none focus:bg-gray-50 rounded px-2 py-1"
                                />
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="flex items-center gap-2 px-4 py-2 text-sm text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
                                    >
                                        <Upload size={16} />
                                        Importar JSON
                                    </button>
                                    <button
                                        onClick={exportJSON}
                                        className="flex items-center gap-2 px-4 py-2 text-sm bg-gray-900 text-white rounded-md hover:bg-gray-800 transition-colors"
                                    >
                                        <Download size={16} />
                                        Exportar JSON
                                    </button>
                                </div>
                            </div>
                            
                            <input
                                ref={fileInputRef}
                                type="file"
                                accept=".json"
                                onChange={importJSON}
                                className="hidden"
                            />
                        </div>

                        {/* Table */}
                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50 border-b border-gray-200">
                                        <tr>
                                            <th className="w-8 px-4 py-3"></th>
                                            <th className="text-left px-4 py-3 text-sm font-medium text-gray-900 min-w-48">
                                                Variable Name
                                            </th>
                                            {modes.map(mode => (
                                                <th key={mode} className="text-left px-4 py-3 text-sm font-medium text-gray-900 min-w-64 relative group">
                                                    <div className="flex items-center justify-between">
                                                        <span>{mode}</span>
                                                        {modes.length > 1 && (
                                                            <button
                                                                onClick={() => removeMode(mode)}
                                                                className="opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-500 transition-all"
                                                            >
                                                                <Trash2 size={14} />
                                                            </button>
                                                        )}
                                                    </div>
                                                </th>
                                            ))}
                                            <th className="w-16 px-4 py-3">
                                                <button
                                                    onClick={addMode}
                                                    className="flex items-center justify-center w-8 h-8 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"
                                                >
                                                    <Plus size={16} />
                                                </button>
                                            </th>
                                            <th className="w-16 px-4 py-3"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {variables.map((variable, index) => (
                                            <tr
                                                key={variable.id}
                                                className="border-b border-gray-100 hover:bg-gray-50 transition-colors"
                                                draggable
                                                onDragStart={(e) => handleDragStart(e, index)}
                                                onDragOver={handleDragOver}
                                                onDrop={(e) => handleDrop(e, index)}
                                            >
                                                <td className="px-4 py-3">
                                                    <div className="cursor-move text-gray-400 hover:text-gray-600">
                                                        <GripVertical size={16} />
                                                    </div>
                                                </td>
                                                <td className="px-4 py-3">
                                                    <input
                                                        type="text"
                                                        value={variable.name}
                                                        onChange={(e) => updateVariableName(variable.id, e.target.value)}
                                                        className="w-full px-3 py-2 text-sm font-bold border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-gray-300"
                                                        placeholder="variable-name"
                                                    />
                                                </td>
                                                {modes.map((mode, modeIndex) => (
                                                    <td key={mode} className="px-4 py-3">
                                                        <div className="space-y-2">
                                                            <textarea
                                                                value={variable.values[mode] || ''}
                                                                onChange={(e) => updateVariableValue(variable.id, mode, e.target.value)}
                                                                className="w-full px-3 py-2 text-sm border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-gray-300 resize-none"
                                                                rows="2"
                                                                placeholder={`Texto en ${mode}`}
                                                            />
                                                            <div className="flex items-center justify-between text-xs">
                                                                <span className={getCountColor(
                                                                    (variable.values[mode] || '').length,
                                                                    variable.charLimit
                                                                )}>
                                                                    {(variable.values[mode] || '').length}/{variable.charLimit}
                                                                </span>
                                                                {modeIndex === 0 && (
                                                                    editingLimit === variable.id ? (
                                                                        <input
                                                                            type="number"
                                                                            defaultValue={variable.charLimit}
                                                                            onBlur={(e) => updateLimit(variable.id, e.target.value)}
                                                                            onKeyDown={(e) => {
                                                                                if (e.key === 'Enter') {
                                                                                    updateLimit(variable.id, e.target.value);
                                                                                }
                                                                            }}
                                                                            className="w-16 px-1 py-0 text-xs border border-gray-300 rounded"
                                                                            autoFocus
                                                                        />
                                                                    ) : (
                                                                        <button
                                                                            onClick={() => setEditingLimit(variable.id)}
                                                                            className="text-gray-400 hover:text-gray-600"
                                                                            title="Editar límite de caracteres"
                                                                        >
                                                                            <Settings size={12} />
                                                                        </button>
                                                                    )
                                                                )}
                                                            </div>
                                                        </div>
                                                    </td>
                                                ))}
                                                <td className="px-4 py-3"></td>
                                                <td className="px-4 py-3">
                                                    <button
                                                        onClick={() => removeVariable(variable.id)}
                                                        className="text-gray-400 hover:text-red-500 transition-colors"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div className="border-t border-gray-200 p-4">
                                <button
                                    onClick={addVariable}
                                    className="flex items-center gap-2 px-4 py-2 text-sm text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors"
                                >
                                    <Plus size={16} />
                                    Agregar Variable
                                </button>
                            </div>
                        </div>

                        <div className="mt-6 text-center text-sm text-gray-500">
                            Editor de Variables de Texto para Figma v2.0
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<FigmaVariablesEditor />, document.getElementById('root'));
    </script>
</body>
</html>
